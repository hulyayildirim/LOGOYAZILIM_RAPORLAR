USE [GO3]
GO

/****** Object:  View [dbo].[TLS_XXX_CEK_SENET_DETAY]    Script Date: 17.08.2023 14:19:06 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[TLS_XXX_CEK_SENET_DETAY] AS
SELECT 
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=002 ) AS 'Firma',
A.DUEDATE [Vade], 
(SELECT CLC.DEFINITION_ FROM LG_002_01_CSTRANS CST, LG_002_CLCARD CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (1,9,10)) [Müşteri Adı],

A.AMOUNT [TL Tutar],
CASE WHEN A.TRCURR IN (0,160) THEN 'TL' ELSE (SELECT CUR.CURCODE FROM L_CURRENCYLIST CUR WHERE CUR.FIRMNR=2 AND CUR.CURTYPE=A.TRCURR) END [Dvz.Türü],
A.TRNET [Dvz.Tutar],

A.SERINO [Seri No],

A.PORTFOYNO [Portföy No],

a.BANKNAME [Çekin Bankası],
A.SPECODE [Çek Özel Kodu],
A.CYPHCODE [Çek Yetki Kodu],
A.CITY [Ödeme Yeri],

CASE WHEN A.DEVIR=1 THEN '20160101' ELSE   a.SETDATE END [Kayıt Tarihi],


CASE WHEN A.CURRSTAT=1 THEN '' ELSE 
ISNULL((SELECT TOP 1 CLC.DEFINITION_ FROM LG_002_01_CSTRANS CST, LG_002_BANKACC CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),'') END  [Tahsile Verilen Banka],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_002_01_CSTRANS CST, LG_002_BANKACC CLC		 WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),GETDATE()) [Bankaya Çıkış Tarihi],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_002_01_CSTRANS CST		 WHERE  CST.CSREF=A.LOGICALREF  ORDER BY CST.LOGICALREF DESC),GETDATE()) [Son İşlem Tarihi],

CASE WHEN A.DOC=1 THEN 'Müşteri Çeki' 
WHEN A.DOC=2 THEN 'Müşteri Senedi' 
WHEN A.DOC=3 THEN 'Kendi Çekimiz' 
ELSE 'Borç Senedimiz' END [Tür],

CASE 
WHEN A.CURRSTAT=1 THEN 'Portföyde ' 
WHEN A.CURRSTAT=2 THEN 'Ciro Edildi '
WHEN A.CURRSTAT=3 THEN 'Teminata Verildi '
WHEN A.CURRSTAT=4 THEN 'Tahsile Verildi '
WHEN A.CURRSTAT=5 THEN 'Tahsile Verildi (Protestolu) '
WHEN A.CURRSTAT=6 THEN 'İade Edildi '
WHEN A.CURRSTAT=7 THEN 'Protesto Edildi '
WHEN A.CURRSTAT=8 THEN 'Tahsil Edildi '
WHEN A.CURRSTAT=9 THEN 'Kendi Çekimiz '
WHEN A.CURRSTAT=11 THEN 'Karşılığı Yok '
WHEN A.CURRSTAT=12 THEN 'Tahsil Edilemiyor '
WHEN A.CURRSTAT=13 THEN 'Portfoyde Karşılıksız '
WHEN A.CURRSTAT=14 THEN 'Portfoyde Protestolu '
else 'Diğer ' end [Durumu ],
A.OWING [KEŞİDECİ],
CASE WHEN A.CIRO=0 THEN 'KENDİ ÇEKİ' ELSE 'CİRO ÇEKİ' END [CEK_DURUMU]
FROM 
LG_002_01_CSCARD A WITH (NOLOCK) 
--WHERE 
--A.DOC  IN( 1,2) AND 
--A.CURRSTAT IN (1,3,4,5)

UNION ALL


SELECT 
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=001 ) AS 'Firma',
A.DUEDATE [Vade], 
(SELECT CLC.DEFINITION_ FROM LG_001_01_CSTRANS CST, LG_001_CLCARD CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (1,9,10)) [Müşteri Adı],

A.AMOUNT [TL Tutar],
CASE WHEN A.TRCURR IN (0,160) THEN 'TL' ELSE (SELECT CUR.CURCODE FROM L_CURRENCYLIST CUR WHERE CUR.FIRMNR=1 AND CUR.CURTYPE=A.TRCURR) END [Dvz.Türü],
A.TRNET [Dvz.Tutar],

A.SERINO [Seri No],

A.PORTFOYNO [Portföy No],

a.BANKNAME [Çekin Bankası],
A.SPECODE [Çek Özel Kodu],
A.CYPHCODE [Çek Yetki Kodu],
A.CITY [Ödeme Yeri],

CASE WHEN A.DEVIR=1 THEN '20160101' ELSE   a.SETDATE END [Kayıt Tarihi],


CASE WHEN A.CURRSTAT=1 THEN '' ELSE 
ISNULL((SELECT TOP 1 CLC.DEFINITION_ FROM LG_001_01_CSTRANS CST, LG_001_BANKACC CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),'') END  [Tahsile Verilen Banka],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_001_01_CSTRANS CST, LG_001_BANKACC CLC		 WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),GETDATE()) [Bankaya Çıkış Tarihi],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_001_01_CSTRANS CST		 WHERE  CST.CSREF=A.LOGICALREF  ORDER BY CST.LOGICALREF DESC),GETDATE()) [Son İşlem Tarihi],

CASE WHEN A.DOC=1 THEN 'Müşteri Çeki' 
WHEN A.DOC=2 THEN 'Müşteri Senedi' 
WHEN A.DOC=3 THEN 'Kendi Çekimiz' 
ELSE 'Borç Senedimiz' END [Tür],

CASE 
WHEN A.CURRSTAT=1 THEN 'Portföyde ' 
WHEN A.CURRSTAT=2 THEN 'Ciro Edildi '
WHEN A.CURRSTAT=3 THEN 'Teminata Verildi '
WHEN A.CURRSTAT=4 THEN 'Tahsile Verildi '
WHEN A.CURRSTAT=5 THEN 'Tahsile Verildi (Protestolu) '
WHEN A.CURRSTAT=6 THEN 'İade Edildi '
WHEN A.CURRSTAT=7 THEN 'Protesto Edildi '
WHEN A.CURRSTAT=8 THEN 'Tahsil Edildi '
WHEN A.CURRSTAT=9 THEN 'Kendi Çekimiz '
WHEN A.CURRSTAT=11 THEN 'Karşılığı Yok '
WHEN A.CURRSTAT=12 THEN 'Tahsil Edilemiyor '
WHEN A.CURRSTAT=13 THEN 'Portfoyde Karşılıksız '
WHEN A.CURRSTAT=14 THEN 'Portfoyde Protestolu '
else 'Diğer ' end [Durumu ],
A.OWING [KEŞİDECİ],
CASE WHEN A.CIRO=0 THEN 'KENDİ ÇEKİ' ELSE 'CİRO ÇEKİ' END [CEK_DURUMU]
FROM 
LG_001_01_CSCARD A WITH (NOLOCK) 
--WHERE 
--A.DOC  IN( 1,2) AND 
--A.CURRSTAT IN (1,3,4,5)

UNION ALL


SELECT 
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=003 ) AS 'Firma',
A.DUEDATE [Vade], 
(SELECT CLC.DEFINITION_ FROM LG_003_01_CSTRANS CST, LG_003_CLCARD CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (1,9,10)) [Müşteri Adı],

A.AMOUNT [TL Tutar],
CASE WHEN A.TRCURR IN (0,160) THEN 'TL' ELSE (SELECT CUR.CURCODE FROM L_CURRENCYLIST CUR WHERE CUR.FIRMNR=3 AND CUR.CURTYPE=A.TRCURR) END [Dvz.Türü],
A.TRNET [Dvz.Tutar],

A.SERINO [Seri No],

A.PORTFOYNO [Portföy No],

a.BANKNAME [Çekin Bankası],
A.SPECODE [Çek Özel Kodu],
A.CYPHCODE [Çek Yetki Kodu],
A.CITY [Ödeme Yeri],

CASE WHEN A.DEVIR=1 THEN '20160101' ELSE   a.SETDATE END [Kayıt Tarihi],


CASE WHEN A.CURRSTAT=1 THEN '' ELSE 
ISNULL((SELECT TOP 1 CLC.DEFINITION_ FROM LG_003_01_CSTRANS CST, LG_003_BANKACC CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),'') END  [Tahsile Verilen Banka],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_003_01_CSTRANS CST, LG_003_BANKACC CLC		 WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),GETDATE()) [Bankaya Çıkış Tarihi],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_003_01_CSTRANS CST		 WHERE  CST.CSREF=A.LOGICALREF  ORDER BY CST.LOGICALREF DESC),GETDATE()) [Son İşlem Tarihi],

CASE WHEN A.DOC=1 THEN 'Müşteri Çeki' 
WHEN A.DOC=2 THEN 'Müşteri Senedi' 
WHEN A.DOC=3 THEN 'Kendi Çekimiz' 
ELSE 'Borç Senedimiz' END [Tür],

CASE 
WHEN A.CURRSTAT=1 THEN 'Portföyde ' 
WHEN A.CURRSTAT=2 THEN 'Ciro Edildi '
WHEN A.CURRSTAT=3 THEN 'Teminata Verildi '
WHEN A.CURRSTAT=4 THEN 'Tahsile Verildi '
WHEN A.CURRSTAT=5 THEN 'Tahsile Verildi (Protestolu) '
WHEN A.CURRSTAT=6 THEN 'İade Edildi '
WHEN A.CURRSTAT=7 THEN 'Protesto Edildi '
WHEN A.CURRSTAT=8 THEN 'Tahsil Edildi '
WHEN A.CURRSTAT=9 THEN 'Kendi Çekimiz '
WHEN A.CURRSTAT=11 THEN 'Karşılığı Yok '
WHEN A.CURRSTAT=12 THEN 'Tahsil Edilemiyor '
WHEN A.CURRSTAT=13 THEN 'Portfoyde Karşılıksız '
WHEN A.CURRSTAT=14 THEN 'Portfoyde Protestolu '
else 'Diğer ' end [Durumu ],
A.OWING [KEŞİDECİ],
CASE WHEN A.CIRO=0 THEN 'KENDİ ÇEKİ' ELSE 'CİRO ÇEKİ' END [CEK_DURUMU]
FROM 
LG_003_01_CSCARD A WITH (NOLOCK) 
--WHERE 
--A.DOC  IN( 1,2) AND 
--A.CURRSTAT IN (1,3,4,5)

UNION ALL

SELECT 
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=023 ) AS 'Firma',
A.DUEDATE [Vade], 
(SELECT CLC.DEFINITION_ FROM LG_023_01_CSTRANS CST, LG_023_CLCARD CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (1,9,10)) [Müşteri Adı],

A.AMOUNT [TL Tutar],
CASE WHEN A.TRCURR IN (0,160) THEN 'TL' ELSE (SELECT CUR.CURCODE FROM L_CURRENCYLIST CUR WHERE CUR.FIRMNR=23 AND CUR.CURTYPE=A.TRCURR) END [Dvz.Türü],
A.TRNET [Dvz.Tutar],

A.SERINO [Seri No],

A.PORTFOYNO [Portföy No],

a.BANKNAME [Çekin Bankası],
A.SPECODE [Çek Özel Kodu],
A.CYPHCODE [Çek Yetki Kodu],
A.CITY [Ödeme Yeri],

CASE WHEN A.DEVIR=1 THEN '20160101' ELSE   a.SETDATE END [Kayıt Tarihi],


CASE WHEN A.CURRSTAT=1 THEN '' ELSE 
ISNULL((SELECT TOP 1 CLC.DEFINITION_ FROM LG_023_01_CSTRANS CST, LG_023_BANKACC CLC WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),'') END  [Tahsile Verilen Banka],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_023_01_CSTRANS CST, LG_023_BANKACC CLC		 WHERE CLC.LOGICALREF=CST.CARDREF AND CST.CSREF=A.LOGICALREF AND CST.STATUS IN (3,4) and TRCODE IN (0,5,7) ORDER BY CST.LOGICALREF DESC),GETDATE()) [Bankaya Çıkış Tarihi],

ISNULL((SELECT TOP 1 CST.DATE_ FROM LG_023_01_CSTRANS CST		 WHERE  CST.CSREF=A.LOGICALREF  ORDER BY CST.LOGICALREF DESC),GETDATE()) [Son İşlem Tarihi],

CASE WHEN A.DOC=1 THEN 'Müşteri Çeki' 
WHEN A.DOC=2 THEN 'Müşteri Senedi' 
WHEN A.DOC=3 THEN 'Kendi Çekimiz' 
ELSE 'Borç Senedimiz' END [Tür],

CASE 
WHEN A.CURRSTAT=1 THEN 'Portföyde ' 
WHEN A.CURRSTAT=2 THEN 'Ciro Edildi '
WHEN A.CURRSTAT=3 THEN 'Teminata Verildi '
WHEN A.CURRSTAT=4 THEN 'Tahsile Verildi '
WHEN A.CURRSTAT=5 THEN 'Tahsile Verildi (Protestolu) '
WHEN A.CURRSTAT=6 THEN 'İade Edildi '
WHEN A.CURRSTAT=7 THEN 'Protesto Edildi '
WHEN A.CURRSTAT=8 THEN 'Tahsil Edildi '
WHEN A.CURRSTAT=9 THEN 'Kendi Çekimiz '
WHEN A.CURRSTAT=11 THEN 'Karşılığı Yok '
WHEN A.CURRSTAT=12 THEN 'Tahsil Edilemiyor '
WHEN A.CURRSTAT=13 THEN 'Portfoyde Karşılıksız '
WHEN A.CURRSTAT=14 THEN 'Portfoyde Protestolu '
else 'Diğer ' end [Durumu ],
A.OWING [KEŞİDECİ],
CASE WHEN A.CIRO=0 THEN 'KENDİ ÇEKİ' ELSE 'CİRO ÇEKİ' END [CEK_DURUMU]
FROM 
LG_023_01_CSCARD A WITH (NOLOCK) 
--WHERE 
--A.DOC  IN( 1,2) AND 
--A.CURRSTAT IN (1,3,4,5)

GO


