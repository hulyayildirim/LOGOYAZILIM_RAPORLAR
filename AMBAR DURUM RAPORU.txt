USE [GO3]
GO

/****** Object:  View [dbo].[TLS_AMBARDURUM_RAPORU]    Script Date: 17.08.2023 14:10:50 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO






CREATE VIEW [dbo].[TLS_AMBARDURUM_RAPORU] AS

SELECT 
'1' [FİRMA NO], 
'ECZANE' [FİRMA ADI],
CW.NR [AMBAR NO],
CW.NAME [AMBAR ADI],
ITEMS.CODE  AS [STOK KODU],
ITEMS.NAME  AS [STOK ADI],
--BRC.BARCODE  [BARKOD],
--LOTN.CODE [LOT],
ISNULL( S1.DEFINITION_ ,'') AS [ÖZEL KOD1],
ISNULL( S2.DEFINITION_ ,'')  AS [ÖZEL KOD2],
ISNULL( S3.DEFINITION_ ,'') AS [ÖZEL KOD3],
ISNULL( ITEMS.SPECODE4 ,'')  AS [ÖZEL KOD4],
ISNULL( ITEMS.SPECODE5 ,'')  AS [ÖZEL KOD5],
ITEMS.STGRPCODE  AS [GRUP KODU],
--SUM(SLT.REMAMOUNT) [LOT STOK],
GNT.ONHAND [FİİLİ STOK],
(GNT.ONHAND-GNT.RESERVED) [GERÇEK STOK],
ISNULL(GNT.SALAMNT,0) [TOP.SATIŞ AD],
ISNULL(GNT.SALCASH,0) [TOP.SATIŞ TUTAR],
ISNULL(GNT.PURAMNT,0) [TOP.ALIŞ AD],
ISNULL(GNT.PURCASH,0) [TOP.ALIŞ TUTAR],
ITEMS.VAT [KDV %]
FROM  LG_001_ITEMS AS  ITEMS 
--LEFT OUTER JOIN LG_001_UNITBARCODE BRC WITH(NOLOCK) ON ITEMS.LOGICALREF=BRC.ITEMREF
LEFT OUTER JOIN LG_001_SPECODES S1 WITH(NOLOCK) ON  ITEMS.SPECODE=S1.SPECODE AND S1.CODETYPE=1 AND S1.SPECODETYPE=1 AND S1.SPETYP1=1
LEFT OUTER JOIN LG_001_SPECODES S2 WITH(NOLOCK) ON  ITEMS.SPECODE2=S2.SPECODE AND S2.CODETYPE=1 AND S2.SPECODETYPE=1 AND S2.SPETYP1=0
LEFT OUTER JOIN LG_001_SPECODES S3 WITH(NOLOCK) ON  ITEMS.SPECODE3=S3.SPECODE AND S3.CODETYPE=1 AND S3.SPECODETYPE=1 AND S3.SPETYP1=0
LEFT OUTER JOIN LG_001_SPECODES S4 WITH(NOLOCK) ON  ITEMS.SPECODE4=S4.SPECODE AND S4.CODETYPE=1 AND S4.SPECODETYPE=1 AND S4.SPETYP1=0
--LEFT OUTER JOIN LG_001_SPECODES S5 WITH(NOLOCK) ON  ITEMS.SPECODE5=S5.SPECODE AND S5.CODETYPE=1 AND S5.SPECODETYPE=1 AND S5.SPETYP1=0
--INNER JOIN LG_001_01_SLTRANS SLT WITH(NOLOCK) ON ITEMS.LOGICALREF=SLT.ITEMREF 
LEFT OUTER JOIN LV_001_01_GNTOTST GNT WITH(NOLOCK) ON GNT.STOCKREF=ITEMS.LOGICALREF AND GNT.INVENNO <>-1
LEFT OUTER JOIN L_CAPIWHOUSE CW WITH(NOLOCK) ON CW.NR=GNT.INVENNO AND CW.FIRMNR=1
--LEFT OUTER JOIN LG_001_01_SERILOTN LOTN WITH(NOLOCK) ON LOTN.LOGICALREF=SLT.SLREF AND LOTN.ITEMREF=ITEMS.LOGICALREF
--WHERE
--ITEMS.CODE='944'
GROUP BY CW.NR,ITEMS.CODE,ITEMS.NAME,ITEMS.SPECODE,S1.DEFINITION_,ITEMS.SPECODE2,S2.DEFINITION_,ITEMS.SPECODE3,S3.DEFINITION_
,ITEMS.SPECODE4,S4.DEFINITION_,ITEMS.SPECODE5,ITEMS.STGRPCODE,ITEMS.VAT,GNT.ONHAND,GNT.RESERVED,GNT.PURAMNT,GNT.SALAMNT,GNT.SALCASH,GNT.PURCASH,CW.NAME
--,LOTN.CODE
UNION ALL
SELECT 
'2' [FİRMA NO], 
'ECZACIN' [FİRMA ADI],
CW.NR [AMBAR NO],
CW.NAME [AMBAR ADI],
ITEMS.CODE  AS [STOK KODU],
ITEMS.NAME  AS [STOK ADI],
--BRC.BARCODE  [BARKOD],
--LOTN.CODE [LOT],
ISNULL( S1.DEFINITION_ ,'') AS [ÖZEL KOD1],
ISNULL( S2.DEFINITION_ ,'')  AS [ÖZEL KOD2],
ISNULL( S3.DEFINITION_ ,'') AS [ÖZEL KOD3],
ISNULL( ITEMS.SPECODE4 ,'')  AS [ÖZEL KOD4],
ISNULL( ITEMS.SPECODE5 ,'')  AS [ÖZEL KOD5],
ITEMS.STGRPCODE  AS [GRUP KODU],
--SUM(SLT.REMAMOUNT) [LOT STOK],
GNT.ONHAND [FİİLİ STOK],
(GNT.ONHAND-GNT.RESERVED) [GERÇEK STOK],
ISNULL(GNT.SALAMNT,0) [TOP.SATIŞ AD],
ISNULL(GNT.SALCASH,0) [TOP.SATIŞ TUTAR],
ISNULL(GNT.PURAMNT,0) [TOP.ALIŞ AD],
ISNULL(GNT.PURCASH,0) [TOP.ALIŞ TUTAR],
ITEMS.VAT [KDV %]
FROM  LG_002_ITEMS AS  ITEMS 
--LEFT OUTER JOIN LG_002_UNITBARCODE BRC WITH(NOLOCK) ON ITEMS.LOGICALREF=BRC.ITEMREF
LEFT OUTER JOIN LG_002_SPECODES S1 WITH(NOLOCK) ON  ITEMS.SPECODE=S1.SPECODE AND S1.CODETYPE=1 AND S1.SPECODETYPE=1 AND S1.SPETYP1=1
LEFT OUTER JOIN LG_002_SPECODES S2 WITH(NOLOCK) ON  ITEMS.SPECODE2=S2.SPECODE AND S2.CODETYPE=1 AND S2.SPECODETYPE=1 AND S2.SPETYP1=0
LEFT OUTER JOIN LG_002_SPECODES S3 WITH(NOLOCK) ON  ITEMS.SPECODE3=S3.SPECODE AND S3.CODETYPE=1 AND S3.SPECODETYPE=1 AND S3.SPETYP1=0
LEFT OUTER JOIN LG_002_SPECODES S4 WITH(NOLOCK) ON  ITEMS.SPECODE4=S4.SPECODE AND S4.CODETYPE=1 AND S4.SPECODETYPE=1 AND S4.SPETYP1=0
--LEFT OUTER JOIN LG_002_SPECODES S5 WITH(NOLOCK) ON  ITEMS.SPECODE5=S5.SPECODE AND S5.CODETYPE=1 AND S5.SPECODETYPE=1 AND S5.SPETYP1=0
--INNER JOIN LG_002_01_SLTRANS SLT WITH(NOLOCK) ON ITEMS.LOGICALREF=SLT.ITEMREF 
LEFT OUTER JOIN LV_002_01_GNTOTST GNT WITH(NOLOCK) ON GNT.STOCKREF=ITEMS.LOGICALREF AND GNT.INVENNO <>-1
LEFT OUTER JOIN L_CAPIWHOUSE CW WITH(NOLOCK) ON CW.NR=GNT.INVENNO AND CW.FIRMNR=2
--LEFT OUTER JOIN LG_002_01_SERILOTN LOTN WITH(NOLOCK) ON LOTN.LOGICALREF=SLT.SLREF AND LOTN.ITEMREF=ITEMS.LOGICALREF
--WHERE
--ITEMS.CODE='944'
GROUP BY CW.NR,ITEMS.CODE,ITEMS.NAME,ITEMS.SPECODE,S1.DEFINITION_,ITEMS.SPECODE2,S2.DEFINITION_,ITEMS.SPECODE3,S3.DEFINITION_
,ITEMS.SPECODE4,S4.DEFINITION_,ITEMS.SPECODE5,ITEMS.STGRPCODE,ITEMS.VAT,GNT.ONHAND,GNT.RESERVED,GNT.PURAMNT,GNT.SALAMNT,GNT.SALCASH,GNT.PURCASH,CW.NAME
--,LOTN.CODE
UNION ALL
SELECT 
'3' [FİRMA NO], 
'DORNE' [FİRMA ADI],
CW.NR [AMBAR NO],
CW.NAME [AMBAR ADI],
ITEMS.CODE  AS [STOK KODU],
ITEMS.NAME  AS [STOK ADI],
--BRC.BARCODE  [BARKOD],
--LOTN.CODE [LOT],
ISNULL( S1.DEFINITION_ ,'') AS [ÖZEL KOD1],
ISNULL( S2.DEFINITION_ ,'')  AS [ÖZEL KOD2],
ISNULL( S3.DEFINITION_ ,'') AS [ÖZEL KOD3],
ISNULL( ITEMS.SPECODE4 ,'')  AS [ÖZEL KOD4],
ISNULL( ITEMS.SPECODE5 ,'')  AS [ÖZEL KOD5],
ITEMS.STGRPCODE  AS [GRUP KODU],
--SUM(SLT.REMAMOUNT) [LOT STOK],
GNT.ONHAND [FİİLİ STOK],
(GNT.ONHAND-GNT.RESERVED) [GERÇEK STOK],
ISNULL(GNT.SALAMNT,0) [TOP.SATIŞ AD],
ISNULL(GNT.SALCASH,0) [TOP.SATIŞ TUTAR],
ISNULL(GNT.PURAMNT,0) [TOP.ALIŞ AD],
ISNULL(GNT.PURCASH,0) [TOP.ALIŞ TUTAR],
ITEMS.VAT [KDV %]
FROM  LG_003_ITEMS AS  ITEMS 
--LEFT OUTER JOIN LG_003_UNITBARCODE BRC WITH(NOLOCK) ON ITEMS.LOGICALREF=BRC.ITEMREF
LEFT OUTER JOIN LG_003_SPECODES S1 WITH(NOLOCK) ON  ITEMS.SPECODE=S1.SPECODE AND S1.CODETYPE=1 AND S1.SPECODETYPE=1 AND S1.SPETYP1=1
LEFT OUTER JOIN LG_003_SPECODES S2 WITH(NOLOCK) ON  ITEMS.SPECODE2=S2.SPECODE AND S2.CODETYPE=1 AND S2.SPECODETYPE=1 AND S2.SPETYP1=0
LEFT OUTER JOIN LG_003_SPECODES S3 WITH(NOLOCK) ON  ITEMS.SPECODE3=S3.SPECODE AND S3.CODETYPE=1 AND S3.SPECODETYPE=1 AND S3.SPETYP1=0
LEFT OUTER JOIN LG_003_SPECODES S4 WITH(NOLOCK) ON  ITEMS.SPECODE4=S4.SPECODE AND S4.CODETYPE=1 AND S4.SPECODETYPE=1 AND S4.SPETYP1=0
--LEFT OUTER JOIN LG_003_SPECODES S5 WITH(NOLOCK) ON  ITEMS.SPECODE5=S5.SPECODE AND S5.CODETYPE=1 AND S5.SPECODETYPE=1 AND S5.SPETYP1=0
--INNER JOIN LG_003_01_SLTRANS SLT WITH(NOLOCK) ON ITEMS.LOGICALREF=SLT.ITEMREF 
LEFT OUTER JOIN LV_003_01_GNTOTST GNT WITH(NOLOCK) ON GNT.STOCKREF=ITEMS.LOGICALREF AND GNT.INVENNO <>-1
LEFT OUTER JOIN L_CAPIWHOUSE CW WITH(NOLOCK) ON CW.NR=GNT.INVENNO AND CW.FIRMNR=3
--LEFT OUTER JOIN LG_003_01_SERILOTN LOTN WITH(NOLOCK) ON LOTN.LOGICALREF=SLT.SLREF AND LOTN.ITEMREF=ITEMS.LOGICALREF
--WHERE
--ITEMS.CODE='944'
GROUP BY CW.NR,ITEMS.CODE,ITEMS.NAME,ITEMS.SPECODE,S1.DEFINITION_,ITEMS.SPECODE2,S2.DEFINITION_,ITEMS.SPECODE3,S3.DEFINITION_
,ITEMS.SPECODE4,S4.DEFINITION_,ITEMS.SPECODE5,ITEMS.STGRPCODE,ITEMS.VAT,GNT.ONHAND,GNT.RESERVED,GNT.PURAMNT,GNT.SALAMNT,GNT.SALCASH,GNT.PURCASH,CW.NAME
--,LOTN.CODE
UNION ALL
SELECT 
'23' [FİRMA NO], 
'ECZACIN SAĞLIK' [FİRMA ADI],
CW.NR [AMBAR NO],
CW.NAME [AMBAR ADI],
ITEMS.CODE  AS [STOK KODU],
ITEMS.NAME  AS [STOK ADI],
--BRC.BARCODE  [BARKOD],
--LOTN.CODE [LOT],
ISNULL( S1.DEFINITION_ ,'') AS [ÖZEL KOD1],
ISNULL( S2.DEFINITION_ ,'')  AS [ÖZEL KOD2],
ISNULL( S3.DEFINITION_ ,'') AS [ÖZEL KOD3],
ISNULL( ITEMS.SPECODE4 ,'')  AS [ÖZEL KOD4],
ISNULL( ITEMS.SPECODE5 ,'')  AS [ÖZEL KOD5],
ITEMS.STGRPCODE  AS [GRUP KODU],
--SUM(SLT.REMAMOUNT) [LOT STOK],
GNT.ONHAND [FİİLİ STOK],
(GNT.ONHAND-GNT.RESERVED) [GERÇEK STOK],
ISNULL(GNT.SALAMNT,0) [TOP.SATIŞ AD],
ISNULL(GNT.SALCASH,0) [TOP.SATIŞ TUTAR],
ISNULL(GNT.PURAMNT,0) [TOP.ALIŞ AD],
ISNULL(GNT.PURCASH,0) [TOP.ALIŞ TUTAR],
ITEMS.VAT [KDV %]
FROM  LG_023_ITEMS AS  ITEMS 
--LEFT OUTER JOIN LG_023_UNITBARCODE BRC WITH(NOLOCK) ON ITEMS.LOGICALREF=BRC.ITEMREF
LEFT OUTER JOIN LG_023_SPECODES S1 WITH(NOLOCK) ON  ITEMS.SPECODE=S1.SPECODE AND S1.CODETYPE=1 AND S1.SPECODETYPE=1 AND S1.SPETYP1=1
LEFT OUTER JOIN LG_023_SPECODES S2 WITH(NOLOCK) ON  ITEMS.SPECODE2=S2.SPECODE AND S2.CODETYPE=1 AND S2.SPECODETYPE=1 AND S2.SPETYP1=0
LEFT OUTER JOIN LG_023_SPECODES S3 WITH(NOLOCK) ON  ITEMS.SPECODE3=S3.SPECODE AND S3.CODETYPE=1 AND S3.SPECODETYPE=1 AND S3.SPETYP1=0
LEFT OUTER JOIN LG_023_SPECODES S4 WITH(NOLOCK) ON  ITEMS.SPECODE4=S4.SPECODE AND S4.CODETYPE=1 AND S4.SPECODETYPE=1 AND S4.SPETYP1=0
--LEFT OUTER JOIN LG_023_SPECODES S5 WITH(NOLOCK) ON  ITEMS.SPECODE5=S5.SPECODE AND S5.CODETYPE=1 AND S5.SPECODETYPE=1 AND S5.SPETYP1=0
--INNER JOIN LG_023_01_SLTRANS SLT WITH(NOLOCK) ON ITEMS.LOGICALREF=SLT.ITEMREF 
LEFT OUTER JOIN LV_023_01_GNTOTST GNT WITH(NOLOCK) ON GNT.STOCKREF=ITEMS.LOGICALREF AND GNT.INVENNO <>-1
LEFT OUTER JOIN L_CAPIWHOUSE CW WITH(NOLOCK) ON CW.NR=GNT.INVENNO AND CW.FIRMNR=23
--LEFT OUTER JOIN LG_023_01_SERILOTN LOTN WITH(NOLOCK) ON LOTN.LOGICALREF=SLT.SLREF AND LOTN.ITEMREF=ITEMS.LOGICALREF
--WHERE
--ITEMS.CODE='944'
GROUP BY CW.NR,ITEMS.CODE,ITEMS.NAME,ITEMS.SPECODE,S1.DEFINITION_,ITEMS.SPECODE2,S2.DEFINITION_,ITEMS.SPECODE3,S3.DEFINITION_
,ITEMS.SPECODE4,S4.DEFINITION_,ITEMS.SPECODE5,ITEMS.STGRPCODE,ITEMS.VAT,GNT.ONHAND,GNT.RESERVED,GNT.PURAMNT,GNT.SALAMNT,GNT.SALCASH,GNT.PURCASH,CW.NAME
--,LOTN.CODE
GO


