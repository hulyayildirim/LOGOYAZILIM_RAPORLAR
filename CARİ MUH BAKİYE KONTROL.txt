USE [GO3]
GO

/****** Object:  View [dbo].[TLS_XXX_CARI_MUH_KONTROL]    Script Date: 17.08.2023 14:14:02 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW [dbo].[TLS_XXX_CARI_MUH_KONTROL] AS
SELECT
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=002 ) AS 'Firma',
 CL.CODE [Cari Kodu],CL.DEFINITION_ [Cari ünvan],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_002_01_GNTOTCL WITH(NOLOCK)  WHERE CARDREF=CL.LOGICALREF AND TOTTYP=1) AS 'Cari_Bakiye',
MUH.CODE [Muhasebe Kodu],MUH.DEFINITION_ [Muhasebe Adı],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_002_01_EMUHTOT WITH(NOLOCK)  WHERE ACCOUNTREF=MUH.LOGICALREF AND TOTTYPE=1) AS 'Muh_Bakiye'
FROM LG_002_CRDACREF REF LEFT OUTER JOIN LG_002_CLCARD CL
ON (REF.CARDREF=CL.LOGICALREF)
LEFT OUTER JOIN LG_002_EMUHACC MUH ON (REF.ACCOUNTREF=MUH.LOGICALREF)
WHERE 
--LEFT(CL.CODE,3) IN ('120','320') 
--AND CL.LOGICALREF=3591
--AND 
REF.TRCODE=5 AND REF.TYP=1 
UNION ALL
SELECT
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=001 ) AS 'Firma',
  CL.CODE [Cari Kodu],CL.DEFINITION_ [Cari ünvan],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_001_01_GNTOTCL WITH(NOLOCK)  WHERE CARDREF=CL.LOGICALREF AND TOTTYP=1) AS 'Cari_Bakiye',
MUH.CODE [Muhasebe Kodu],MUH.DEFINITION_ [Muhasebe Adı],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_001_01_EMUHTOT WITH(NOLOCK)  WHERE ACCOUNTREF=MUH.LOGICALREF AND TOTTYPE=1) AS 'Muh_Bakiye'
FROM LG_001_CRDACREF REF LEFT OUTER JOIN LG_001_CLCARD CL
ON (REF.CARDREF=CL.LOGICALREF)
LEFT OUTER JOIN LG_001_EMUHACC MUH ON (REF.ACCOUNTREF=MUH.LOGICALREF)
WHERE 
--LEFT(CL.CODE,3) IN ('120','320') 
--AND CL.LOGICALREF=3591
--AND 
REF.TRCODE=5 AND REF.TYP=1 
UNION ALL
SELECT
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=003 ) AS 'Firma',
 CL.CODE [Cari Kodu],CL.DEFINITION_ [Cari ünvan],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_003_01_GNTOTCL WITH(NOLOCK)  WHERE CARDREF=CL.LOGICALREF AND TOTTYP=1) AS 'Cari_Bakiye',
MUH.CODE [Muhasebe Kodu],MUH.DEFINITION_ [Muhasebe Adı],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_003_01_EMUHTOT WITH(NOLOCK)  WHERE ACCOUNTREF=MUH.LOGICALREF AND TOTTYPE=1) AS 'Muh_Bakiye'
FROM LG_003_CRDACREF REF LEFT OUTER JOIN LG_003_CLCARD CL
ON (REF.CARDREF=CL.LOGICALREF)
LEFT OUTER JOIN LG_003_EMUHACC MUH ON (REF.ACCOUNTREF=MUH.LOGICALREF)
WHERE 
--LEFT(CL.CODE,3) IN ('120','320') 
--AND CL.LOGICALREF=3591
--AND 
REF.TRCODE=5 AND REF.TYP=1 
UNION ALL
SELECT
	(SELECT CASE WHEN LEN(CAST(NR AS VARCHAR(3)))=1 THEN '00'+CAST(NR AS VARCHAR(3)) WHEN LEN(CAST(NR AS VARCHAR(3)))=2 THEN '0'+CAST(NR AS VARCHAR(3)) ELSE  CAST(NR AS VARCHAR(3)) END + ' - ' + TITLE FROM L_CAPIFIRM WHERE NR=023 ) AS 'Firma',
 CL.CODE [Cari Kodu],CL.DEFINITION_ [Cari ünvan],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_023_01_GNTOTCL WITH(NOLOCK)  WHERE CARDREF=CL.LOGICALREF AND TOTTYP=1) AS 'Cari_Bakiye',
MUH.CODE [Muhasebe Kodu],MUH.DEFINITION_ [Muhasebe Adı],
(SELECT ROUND(SUM(DEBIT-CREDIT),2) FROM LV_023_01_EMUHTOT WITH(NOLOCK)  WHERE ACCOUNTREF=MUH.LOGICALREF AND TOTTYPE=1) AS 'Muh_Bakiye'
FROM LG_023_CRDACREF REF LEFT OUTER JOIN LG_023_CLCARD CL
ON (REF.CARDREF=CL.LOGICALREF)
LEFT OUTER JOIN LG_023_EMUHACC MUH ON (REF.ACCOUNTREF=MUH.LOGICALREF)
WHERE 
--LEFT(CL.CODE,3) IN ('120','320') 
--AND CL.LOGICALREF=3591
--AND 
REF.TRCODE=5 AND REF.TYP=1 
GO


